
@{
    ViewBag.Title = "GlobalChat";
}

<h2>GlobalChat</h2>

<div>
    <textarea id="chatbox" cols="100" rows="10" readonly></textarea>
    <br />
    <input type="text" id="message" />
    <input type="button" id="sendmessage" value="Send" />
</div>

<!-- Jeg har flyttet inkludering av alle javascriptene til Head, så du skal ikke trenge å importere jquery her
<script type="text/javascript" src="/Scripts/jquery-2.1.1.min.js"></script>
-->
<script>

        function startChat() {
            var chat = $.connection.globalChatHub;
            var username = "@User.Identity.Name";

            chat.client.addNewMessageToPage = function (username, message) {
                $("#chatbox").append(username + ": " + message + "\n");
            };

            $.connection.hub.start().done(function () {
                $("#sendmessage").click(function () {
                    chat.server.send(username, $("#message").val());
                    $('#message').val('').focus();
                });
            });
        }

        $(document).ready(function () {
            startChat();
        });
</script>